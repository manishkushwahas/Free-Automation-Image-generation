<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Webhook Image Preview & Download</title>

<!-- ‚úÖ Bootstrap 5 CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- ‚úÖ Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, #dbeafe, #e0f2fe, #f3e8ff);
    color: #1e293b;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .container {
    background: white;
    border-radius: 16px;
    box-shadow: 0 6px 25px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    width: 1000px;
    height: 600px;
    max-width: 95%;
    animation: fadeIn 1s ease-in-out;
  }

  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }

  .left-panel {
    background: linear-gradient(145deg, #4f46e5, #3b82f6, #06b6d4);
    color: white;
    padding: 40px;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    border-right: 4px solid #e2e8f0;
    box-shadow: inset -5px 0 20px rgba(0, 0, 0, 0.1);
  }

  .left-panel h2 {
    font-weight: 700;
    margin-bottom: 20px;
    text-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .form-control {
    border-radius: 10px;
    border: none;
    padding: 12px;
    font-size: 16px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }

  .btn-primary {
    background: #10b981;
    border: none;
    border-radius: 10px;
    transition: all 0.3s;
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(16,185,129,0.4);
  }
  .btn-primary:hover {
    background: #059669;
    transform: scale(1.05);
  }

  #status {
    margin-top: 15px;
    font-weight: 600;
    color: #e0f2fe;
  }

  .right-panel {
    padding: 40px;
    height: 100%;
    overflow-y: auto;
    background: #f8fafc;
    position: relative;
    transition: background 0.3s;
  }

  #previewImage {
    max-width: 100%;
    border-radius: 12px;
    display: none;
    transition: all 0.4s ease;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
  }

  #previewImage:hover {
    transform: scale(1.03);
  }

  .action-btns button {
    margin-top: 12px;
    margin-right: 10px;
    border: none;
    border-radius: 8px;
    color: white;
    font-weight: 600;
    transition: 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  #openBtn {
    background: #0284c7;
  }
  #openBtn:hover {
    background: #0369a1;
    transform: scale(1.05);
  }
  #downloadBtn {
    background: #16a34a;
  }
  #downloadBtn:hover {
    background: #15803d;
    transform: scale(1.05);
  }

  .agent-output {
    margin-top: 25px;
    background: #ffffff;
    padding: 20px;
    border-radius: 12px;
    white-space: pre-wrap;
    transition: 0.3s;
    border: 1px solid #e2e8f0;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }

  /* üåü Hashtag styling */
  .agent-output span.hashtag {
    color: #2563eb;
    font-weight: 700;
  }

  /* Scrollbar styling for right panel */
  .right-panel::-webkit-scrollbar {
    width: 8px;
  }
  .right-panel::-webkit-scrollbar-thumb {
    background-color: #94a3b8;
    border-radius: 4px;
  }
</style>
</head>

<body>
  <div class="container shadow-lg">
    <div class="row g-0 h-100">
      <!-- üîπ Left Panel -->
      <div class="col-md-4 left-panel">
        <h2>üé® Image Search</h2>
        <input type="text" id="inputValue" class="form-control mb-3" placeholder="Enter keyword..." />
        <button id="sendBtn" class="btn btn-primary w-100">Send to Webhook</button>
        <p id="status" class="mt-3"></p>
      </div>

      <!-- üîπ Right Panel -->
      <div class="col-md-8 right-panel">
        <img id="previewImage" alt="Preview will appear here" />
        <div class="action-btns mt-3">
          <button id="openBtn" class="btn">ü°≥ Open Image</button>
          <button id="downloadBtn" class="btn">‚¨áÔ∏è Download</button>
        </div>
        <div id="agentOutput" class="agent-output mt-4" style="display:none;"></div>
      </div>
    </div>
  </div>

  <script>
    const webhookURL = 'https://mcmflow.app.n8n.cloud/webhook-test/manish';
    const input = document.getElementById('inputValue');
    const btn = document.getElementById('sendBtn');
    const status = document.getElementById('status');
    const previewImage = document.getElementById('previewImage');
    const openBtn = document.getElementById('openBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const agentOutput = document.getElementById('agentOutput');

    async function sendToWebhook() {
      const value = input.value.trim();
      if (!value) {
        status.textContent = '‚ùå Please enter a value!';
        return;
      }

      const payload = { keyword: value };
      status.textContent = '‚è≥ Sending...';
      previewImage.style.display = 'none';
      openBtn.style.display = 'none';
      downloadBtn.style.display = 'none';
      agentOutput.style.display = 'none';
      agentOutput.innerHTML = '';

      try {
        const response = await fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const text = await response.text();
        if (!response.ok) {
          status.textContent = `‚ùå Failed (HTTP ${response.status})`;
          return;
        }

        let json;
        try {
          json = JSON.parse(text);
        } catch {
          status.textContent = '‚ö†Ô∏è Invalid JSON response';
          console.error(text);
          return;
        }

        const webViewLink = json.webViewLink || (json.body && json.body.webViewLink);
        const webContentLink = json.webContentLink || (json.body && json.body.webContentLink);
        let output = json.output || (json.body && json.body.output) || '';

        if (typeof output === 'string' && output.trim().startsWith('{')) {
          try {
            output = JSON.parse(output);
          } catch (err) {
            console.warn('‚ö†Ô∏è Could not parse output JSON:', err);
          }
        }

        const idMatch = webViewLink ? webViewLink.match(/\/d\/([a-zA-Z0-9_-]+)/) : null;
        let previewURL = webContentLink || webViewLink;
        let downloadURL = webContentLink || webViewLink;

        if (idMatch) {
          const fileId = idMatch[1];
          previewURL = `https://lh3.googleusercontent.com/d/${fileId}=s1200`;
          downloadURL = `https://drive.google.com/uc?export=download&id=${fileId}`;
        }

        if (previewURL) {
          previewImage.src = previewURL;
          previewImage.style.display = 'block';
          openBtn.style.display = 'inline-block';
          downloadBtn.style.display = 'inline-block';

          openBtn.onclick = () => window.open(previewURL, '_blank');
          downloadBtn.onclick = () => {
            const a = document.createElement('a');
            a.href = downloadURL;
            a.download = 'image.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
          };
        }

        if (output) {
          let content = typeof output === 'object' && output.description ? output.description : output;
          if (typeof content === 'string') {
            content = content.replace(/#(\w+)/g, '<span class="hashtag">#$1</span>');
          }
          agentOutput.innerHTML = typeof content === 'string' ? content : JSON.stringify(content, null, 2);
          agentOutput.style.display = 'block';
        } else {
          agentOutput.innerHTML = '<p>‚ö†Ô∏è No Agent1 output found.</p>';
          agentOutput.style.display = 'block';
        }

        status.textContent = '‚úÖ Image & Agent1 output loaded successfully!';
      } catch (error) {
        console.error(error);
        status.textContent = '‚ö†Ô∏è Network Error: ' + error.message;
      }
    }

    btn.addEventListener('click', sendToWebhook);
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') sendToWebhook();
    });
  </script>

  <!-- ‚úÖ Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
